# Mosquitto MQTT Broker Configuration
# IoT Renewable Energy Monitoring System
# Version: 2.0.18
# Security Level: Production Ready

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================

# MQTT Port (Standard)
listener 1883
protocol mqtt
max_connections 1000

# WebSocket Port (for web applications)
listener 9001
protocol websockets
max_connections 500

# Connection timeout and keepalive
connection_messages true
log_timestamp true
keepalive_interval 60
retry_interval 20

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# Disable anonymous connections for production security
allow_anonymous false

# Password file for device authentication
password_file /mosquitto/config/passwd

# Access Control List for topic-based permissions
acl_file /mosquitto/config/acl

# Certificate files for SSL/TLS (uncomment for production)
# cafile /mosquitto/config/certs/ca.crt
# certfile /mosquitto/config/certs/server.crt
# keyfile /mosquitto/config/certs/server.key
# require_certificate false
# use_identity_as_username true

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log destination
log_dest stdout
log_dest file /mosquitto/log/mosquitto.log

# Log types and levels
log_type error
log_type warning
log_type notice
log_type information
log_type debug
log_type subscribe
log_type unsubscribe
log_type websockets

# Log timestamp format
log_timestamp true

# Log file rotation
log_facility daemon

# =============================================================================
# PERSISTENCE CONFIGURATION
# =============================================================================

# Enable persistence for message storage
persistence true
persistence_location /mosquitto/data/

# Autosave configuration
autosave_interval 1800
autosave_on_changes false

# Persistence file settings
persistence_file mosquitto.db

# =============================================================================
# MESSAGE CONFIGURATION
# =============================================================================

# Message handling
allow_duplicate_messages false
max_inflight_messages 20
max_queued_messages 100

# Message size limit (0 = unlimited)
message_size_limit 0

# Retained messages
retained_persistence true

# =============================================================================
# PERFORMANCE CONFIGURATION
# =============================================================================

# Memory and packet limits
max_packet_size 0
max_queued_messages 100

# Thread configuration
max_inflight_messages 20
max_inflight_bytes 0

# =============================================================================
# BRIDGE CONFIGURATION (Optional)
# =============================================================================

# Bridge to external MQTT broker for data replication
# connection bridge-external
# address external-broker.com:1883
# username bridge_user
# password bridge_password
# topic devices/+/+/data out 1 "" devices/
# topic devices/+/+/status out 1 "" devices/
# topic devices/+/+/commands in 1 "" devices/
# topic system/health/+ out 1 "" system/
# topic system/alerts/+ out 1 "" system/

# =============================================================================
# PLUGIN CONFIGURATION (Optional)
# =============================================================================

# Plugin path for custom authentication/authorization
# plugin /mosquitto/lib/mosquitto_plugin.so

# =============================================================================
# CUSTOM SETTINGS FOR RENEWABLE ENERGY SYSTEM
# =============================================================================

# Topic structure for renewable energy devices:
# devices/{device_type}/{device_id}/data      - Telemetry data
# devices/{device_type}/{device_id}/status    - Device status
# devices/{device_type}/{device_id}/commands  - Control commands
# system/health/{service_name}                - System health
# system/alerts/{severity}                    - System alerts

# Device types supported:
# - photovoltaic
# - wind_turbine
# - biogas_plant
# - heat_boiler
# - energy_storage

# Example topics:
# devices/photovoltaic/pv_001/data
# devices/wind_turbine/wt_001/status
# devices/energy_storage/es_001/commands
# system/health/mosquitto
# system/alerts/critical 